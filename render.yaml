services:
  - type: web
    name: ai-emotional-safety-backend
    runtime: node
    plan: free
    region: oregon
    buildCommand: |
      echo "ğŸ“¦ å®‰è£…Node.jsä¾èµ–..."
      npm install
      echo "ğŸ åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ..."
      python3 -m venv venv || echo "âš ï¸ Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå¤±è´¥ï¼Œç»§ç»­ä½¿ç”¨ç³»ç»ŸPython"
      if [ -d "venv" ]; then
        source venv/bin/activate
        echo "ğŸ“š å®‰è£…Pythonä¾èµ–åˆ°è™šæ‹Ÿç¯å¢ƒ..."
        pip install --upgrade pip
        pip install -r requirements.txt || echo "âš ï¸ Pythonä¾èµ–å®‰è£…å¤±è´¥ï¼Œå°†ä½¿ç”¨å›é€€æ¨¡å¼"
      else
        echo "ğŸ ä½¿ç”¨ç³»ç»ŸPythonå®‰è£…ä¾èµ–..."
        pip3 install --user -r requirements.txt || echo "âš ï¸ Pythonä¾èµ–å®‰è£…å¤±è´¥ï¼Œå°†ä½¿ç”¨å›é€€æ¨¡å¼"
      fi
      echo "âœ… æ„å»ºå®Œæˆ"
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        fromService:
          type: web
          name: ai-emotional-safety-backend
          property: port
    healthCheckPath: /api/health
    autoDeploy: true
    branch: main 